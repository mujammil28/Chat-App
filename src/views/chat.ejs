<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style type="text/css">


        body{
                background-color: #e7e7e7;
        }




        #chat-section{  

            display: grid;
            grid-template-columns: 1fr 2fr;
            justify-content: space-around;
            align-items:center;
            justify-items: center;


        }


        #chat-box-section{
           
            background-image: url('../../public/media/chat-background-imgae.jpg');
            width: 80vw;
            height: 92vh;
            background-repeat:repeat;
            display: grid;
            grid-template-rows: 1fr 6fr 1fr;
            justify-content: space-around;
            align-items:center;
            justify-items: center;
            border: rgb(211, 211, 211),2px,solid;
            border-radius: 10px;
            margin: 10px;
        }


       

        .chat-header{
                margin: 20px;
        }

        #user-name{
            color:rgb(0, 196, 46);
            font-size:20px;

        }

        #user-typing{
            font-style: italic;
            color:#888;
        }

        #chat-header{
            background-color: transparent;
            width: 80vw;
            height: 100%;
            display: grid;
            grid-template-columns: 2fr 1fr 4fr;
            justify-content:start;
            align-items: center;
            background: rgb(255, 255, 255, 0.7); 
            border: rgb(211, 211, 211),1px,solid;
            
        }

        #chat-history{
            background-color: transparent;
            width: 100%;
            height: 100%;
            overflow:auto;
        }

        #chat-box{

            background-color: transparent;
            width: 100%;
            height: 100%;
            background: rgb(255, 255, 255, 0.7); 
            border: rgb(211, 211, 211),1px,solid;
            display: grid;
            align-items: center;
         
        }

        #chating{
            display: grid;
            grid-template-columns: 4fr 1fr;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
        }   

        #chat-typing{
            margin: 20px;
            height: 30px;
             border-radius:10px;
             border:1px solid black;
             padding-left:10px;
             
        }

        #chat-send-btn{
            margin: 20px;
            height: 30px;
            background-color:rgb(0, 196, 46);
                    color:white;
                    border-radius:10px;
                    border:1px solid white;
        }

         .user-name{
            margin-right:20px;
            color: rgb(146, 146, 146);
            font-size: 14px;
            font-style: italic;

        }


        .chat-time{

            color: rgb(95, 95, 95);
            font-size: 14px;
            font-style: italic;


        }

        .user-image{
            margin-right:20px;
            background-color: transparent;
        }

        .user-image>img {
    height: auto;
    width: auto;
    object-fit: fill;
    border-radius: 50%;
    max-width: 4vw;
    min-height: 7vh;
    max-height: 8vh;
}

#chat-history::-webkit-scrollbar {
    width: 8px; 
    margin-left: 10px; 
}

#chat-history::-webkit-scrollbar-thumb {
    background-color: #888; 
    border-radius: 4px; 

}

#chat-history::-webkit-scrollbar-thumb:hover {
    background-color: #555; 
}

#chat-history::-webkit-scrollbar-track {
    background: #f1f1f1; 
}



            .user1{
                display:flex;
                justify-content:start;
                align-items:center;
                margin:10px;
               
            }
            .user2{
                display:flex;
                justify-content:end;
                align-items:center;
             
            }

            #typed-text{
                display:flex;
                justify-content:end;
                align-items:end;
                text-align:end;
                margin:10px;
            }

            .sender-text{
                display:flex;
                justify-content:start;
                align-items:start;
                text-align:start;
                margin:10px;
           
            }


            .name-time{

                display:flex;
                flex-direction:row;
               justify-content:space-between;
               padding:5px;
                min-width:10vw;
            }

           
            .chat-text{
                display:grid;
                grid-template-rows:1fr;
                background-color:white;
                border:1.5px solid #00bc7b;
                width:40vw; 
               border-radius:20px;
                height:auto;
                min-height:5vh;
                margin:0px 20px 20px 20px;
                width:auto;
                max-width:40vw;
                padding:5px;
                border-bottom-left-radius: 1%;
            }


            .sender-chat-text{
                display:grid;
                grid-template-rows:1fr;
                height:auto;
                min-height:5vh;
               margin:20px;
               background-color:rgb(183, 243, 222);
                width:40vw; 
                border:1.5px solid #00bc7b;
               border-radius:20px;
                min-height:5vh;
                margin:20px;
                width:auto;
                max-width:40vw;
                padding:5px;
                border-bottom-right-radius: 1%;
            }

            .connected-user{
                display: flex;
                align-items: center;
                justify-content: space-between;
                align-content: center;
                background-color: rgba(166, 222, 255, 0.886);
                border: 1px solid white;
            }

            #connected>th{
                background-color:rgb(32, 161, 235);
                color:white;
                height: 7vh;
             
                border-radius: 10px;

            }

            .connected-user>td{

                    background-color: rgba(166, 222, 255, 0.886);
                 
                    border-radius: 5px;
                    display: flex;
                align-items: center;
                justify-content: space-between;
                align-content: center;
                margin-left: 10px;
                    height: 5vh;
            }

            #group-table{
               width:10vw;
              border: 1px solid #ffffff;
            }
            #circle{
                height: 15px;
                width: 15px;
                background-color: #ff5353;
                border-radius: 50%;
                margin-right: 10px;
            }
            #circle>strong{
                margin-left: 10px;
            }


       
        @media only screen and (max-width: 600px) {
    body {
        background-color: #e7e7e7; /* Keep background consistent */
    }

    #chat-section {
        display: block; /* Stack the sections vertically */
        padding: 10px;
    }

    #chat-box-section {
        width: 83vw;
        height: 88vh; /* Allow height to adjust dynamically */
        margin: 0 auto 20px auto;
        border-radius: 8px;

    }

    #chat-header {
        width: 94%;
        grid-template-columns: 1fr; /* Adjust header layout */
        padding: 10px;
        height: 8vh;
    }

    #chat-history {
        width: 100%;
        height: 60vh; /* Limit height for smaller screens */
    }

    #chat-box {
        width: 100%;
    }

    #chating {
        grid-template-columns: 4fr 1fr; /* Maintain alignment for input and button */
        gap: 10px;
    }

    #chat-typing {
        width: 90%;
        height: 35px;
        font-size: 14px;
    }

    #chat-send-btn {
        height: 35px;
        font-size: 14px;
    }

    .chat-text,
    .sender-chat-text {
        width: 80%;
        font-size: 14px; /* Adjust font size for readability */
    }

    .chat-time, .user-name {
        font-size: 12px; /* Adjust text size for timestamps and names */
    }

    .user-image > img {
        max-width: 10vw; /* Adjust image size */
        max-height: 10vh;
    }

    .connected-user {
        font-size: 14px;
        padding: 5px;
    }

    #group-table {
        width: 100%; /* Expand the table for smaller screens */
    }

    #connected > th {
        font-size: 16px; /* Adjust font size of table headers */
        height: 5vh;
    }
}





</style>



</head>
<body>
    <div id="chat-section">
    <div class="chat-area" id="chat-box-section">
       
        <div id="chat-header">
            <div id="user-name" class="chat-header">Welcome &nbsp; <%=user.name %></div>
            <div id="user-typing" class="chat-header"></div>
        </div>
        <div id="chat-history" >
            
            
            <!-- <div class="user1">
                <div class="user-image">
                    <img src="public/media/logoImg.png">
                </div>
                
                <div class="chat-text">
                    <div class="name-time">
                      <div class="user-name">User1</div>
                       <div class="chat-time">02:20 PM</div>
                      </div>
                          <div class="sender-text">
                          Hello
                          </div>
                  
               </div> 
            </div> -->
           
           
           <!--  <div class="user2">
                <div class="sender-chat-text">
                    <div class="name-time">
                      <div class="user-name">User2</div>
                       <div class="chat-time">02:20 PM</div>
                      </div>
                          <div id="typed-text">
                          Hello
                          </div>
                  
               </div> 
                <div class="user-image">
             
                    <img src="public/media/logoImg.png">
                </div>
            </div> -->
            

            <div id="own-user-name" style="display: none;"><%=user.name %></div>
            <div id="own-user-image" style="display: none;"><%=user.image%></div>

    </div>
        <div id="chat-box">
            <form id="chating">
            <input type="text" placeholder="Say hi..." id="chat-typing" />
            <input type="submit" value="SEND" id="chat-send-btn"  />
            </form>
        </div>
         </div>
    
    <div class="connection-area" id="group-connections">
        <table id="group-table">
            <tr id="connected">
                <th>Connected Users</th>
            </tr>
            <% users.forEach(user => { %>
            <tr class="connected-user">
                <td>
                    <span id="circle-<%= user.id %>" class="circle"></span>
                    <strong><%= user.name %></strong>
                </td>
            </tr>
            <% }); %>
        </table>

    </div>
    
</div>

    <script src="/socket.io/socket.io.js"></script>

    <script >
                       const socket = io(); // Automatically connects to the same host
                 
                 
                    const chatTyping=document.getElementById('chat-typing');
                    const chatSendBtn=document.getElementById('chat-send-btn');
                    const chating=document.getElementById('chating');
                    const typedText=document.getElementById('typed-text');
                    const chatHistory=document.getElementById('chat-history');
                    const ownUserName=document.getElementById('own-user-name');
                    const ownUserImage=document.getElementById('own-user-image');
                    const userTyping=document.getElementById('user-typing')
                    const nameOfUser=ownUserName.innerHTML;

        
                 
                    chating.addEventListener('submit',(event)=>{

                        event.preventDefault();
                        const chatText=chatTyping.value.trim();
                         
                        if(chatText){
                            console.log(chatText);
                        
                     const userSecond=document.createElement("div")
                     userSecond.className="user2";
                     chatHistory.appendChild(userSecond);

                    const senderChatText=document.createElement("div");
                    senderChatText.className="sender-chat-text";
                    userSecond.appendChild(senderChatText);

                    const nameTime=document.createElement("div");
                    nameTime.className="name-time";
                    senderChatText.appendChild(nameTime);

                    const userName=document.createElement("div");
                    userName.className="user-name";
                    
                    userName.innerText="You("+ownUserName.innerHTML+")";
                    nameTime.appendChild(userName);

                    const chatTime=document.createElement("div");
                    chatTime.className="chat-time";
                    const date=new Date();
                    const months = [
                    "January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];
                    const day = date.getDate(); 
                    const month = months[date.getMonth()]; 
                    const year = date.getFullYear(); 
                    let hours = date.getHours(); 
                    let ampm='AM';

                    if(hours>12){
                        hours=hours-12;
                         ampm='PM'; 
                        }
                  
                    const minutes = date.getMinutes(); 
                    chatTime.innerText=` ${year}, ${month} ${day},  ${hours}:${minutes}  ${ampm}`;
                    nameTime.appendChild(chatTime);

                    const typedText=document.createElement("div");
                    typedText.id="typed-text";
                    senderChatText.appendChild(typedText);
                        
                    const userImage=document.createElement("div");
                    userImage.className="user-image";
                    userSecond.appendChild(userImage);

                    const image=document.createElement("img");
                    image.src=`public/${ownUserImage.innerHTML}`;
                    image.alt="User Image";
                    userImage.appendChild(image);

                     
                    const typedTextChild=document.createElement("div");
                    typedTextChild.innerText=chatText;
                    typedText.appendChild(typedTextChild);

                    let nameMessage={
                        message:chatText,
                        uName:ownUserName.innerHTML,
                        image:ownUserImage.innerHTML,
                    }
                    
                    socket.emit('new_message',nameMessage);
                        


                       chatTyping.value="";
                       chatHistory.scrollTop = chatHistory.scrollHeight;


                        }
                        
                    });

                    socket.on('load_Messages',(messages)=>{
                messages.forEach(message => {
                           const messageEle=document.createElement("div");

                //2024-12-24T10:30:20.484Z
                const userFirst=document.createElement("div")
                    userFirst.className="user1";
                     chatHistory.appendChild(userFirst);

                const userImage=document.createElement("div");
                    userImage.className="user-image";
                    userFirst.appendChild(userImage);

                    const image=document.createElement("img");
                    image.src=`public/${message.image}`;
                    image.alt="User Image";
                    userImage.appendChild(image);


             

                    const chatingText=document.createElement("div");
                    chatingText.className="chat-text";
                    userFirst.appendChild(chatingText);

                    const nameTime=document.createElement("div");
                    nameTime.className="name-time";
                    chatingText.appendChild(nameTime);

                    const userName=document.createElement("div");
                    userName.className="user-name";
                    userName.style.color="#00bc7b";
                    console.log(message)
                    userName.innerText="~  "+message.userName;
                    nameTime.appendChild(userName);

                    const chatTime=document.createElement("div");
                    chatTime.className="chat-time"; 
                    chatTime.innerText=message.dateTime;
                    nameTime.appendChild(chatTime);

                    const senderText=document.createElement("div");
                    senderText.className="sender-text";
                    chatingText.appendChild(senderText);
                        
                    

                     
                    const typedTextChild=document.createElement("div");
                    typedTextChild.innerText=message.message;
                    senderText.appendChild(typedTextChild);

               
                    });
               
            })

               
                    socket.on('send_message',(userDetail)=>{
                
                
                        console.log(userDetail.dateTime)
                        
                        const messageEle=document.createElement("div");

                //2024-12-24T10:30:20.484Z
                const userFirst=document.createElement("div")
                    userFirst.className="user1";
                     chatHistory.appendChild(userFirst);

                const userImage=document.createElement("div");
                    userImage.className="user-image";
                    userFirst.appendChild(userImage);

                    const image=document.createElement("img");
                    image.src=`public/${userDetail.image}`;
                    image.alt="User Image";
                    userImage.appendChild(image);


             

                    const chatingText=document.createElement("div");
                    chatingText.className="chat-text";
                    userFirst.appendChild(chatingText);

                    const nameTime=document.createElement("div");
                    nameTime.className="name-time";
                    chatingText.appendChild(nameTime);

                    const userName=document.createElement("div");
                    userName.className="user-name";
                    userName.style.color="#00bc7b"
                    userName.innerText="~  "+userDetail.name;
                    nameTime.appendChild(userName);

                    const chatTime=document.createElement("div");
                    chatTime.className="chat-time";
                    const date=new Date();
                    const months = [
                    "January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];
                    const day = date.getDate(); 
                    const month = months[date.getMonth()]; 
                    const year = date.getFullYear(); 
                    let hours = date.getHours(); 
                    let ampm='AM';

                    if(hours>12){
                        hours=hours-12;
                        ampm='PM';
                    }
                    const minutes = date.getMinutes(); 
                    chatTime.innerText=` ${year}, ${month} ${day},  ${hours}:${minutes} ${ampm}`;
                    nameTime.appendChild(chatTime);

                    const senderText=document.createElement("div");
                    senderText.className="sender-text";
                    chatingText.appendChild(senderText);
                        
                    

                     
                    const typedTextChild=document.createElement("div");
                    typedTextChild.innerText=userDetail.message;
                    senderText.appendChild(typedTextChild);

               

            })                   
                    


    </script>






</body>
</html>